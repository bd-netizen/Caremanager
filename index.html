import React, { useState, useRef } from 'react';
import { Info, CheckCircle, ArrowRight, RotateCcw, Filter, Settings, Link as LinkIcon, Search, FileText, ExternalLink, Cloud, Edit3, Printer, FileOutput, ChevronLeft } from 'lucide-react';

// --- è³‡æ–™é›†è¨­å®š (åˆå§‹å€¼) ---
const INITIAL_DATA = [
  // A. äººåŠ›è³‡æº
  { id: 'A01', label: 'æ‰¾ä¸å¤–çœ‹', desc: 'æ‰¾ä¸åˆ°å¤–ç±çœ‹è­·', x: 85, y: 95, cat: 'A' }, // Q1
  { id: 'A02', label: 'å¤–çœ‹é€ƒé›¢', desc: 'å¤–ç±çœ‹è­·é€ƒè·‘æˆ–æœŸæ»¿é›¢å¢ƒ', x: 95, y: 98, cat: 'A' }, // Q1
  { id: 'A03', label: 'ç”³è«‹å¤–çœ‹', desc: 'ä¸çŸ¥é“å¦‚ä½•ç”³è«‹å¤–ç±çœ‹è­·', x: 40, y: 45, cat: 'A' }, // Q3
  { id: 'A04', label: 'æœ¬çœ‹å¤ªè²´', desc: 'æœ¬åœ‹çœ‹è­·è²»ç”¨å¤ªé«˜ç„¡æ³•è² æ“”', x: 90, y: 90, cat: 'A' }, // Q1
  { id: 'A05', label: 'çœ‹è­·ç›¸è™•', desc: 'çœ‹è­·èˆ‡å®¶äºº/é•·è¼©ç›¸è™•ä¸è‰¯', x: 75, y: 48, cat: 'A' }, // Q4
  { id: 'A06', label: 'çœ‹è­·æŠ€èƒ½', desc: 'çœ‹è­·æŠ€èƒ½ä¸è¶³æˆ–ä¸å°ˆæ¥­', x: 60, y: 88, cat: 'A' }, // Q1
  { id: 'A07', label: 'è‡¨æ™‚çœ‹è­·', desc: 'æ‰¾ä¸åˆ°å¯ä¿¡ä»»çš„è‡¨æ™‚çœ‹è­·', x: 80, y: 75, cat: 'A' }, // Q1
  { id: 'A08', label: 'é¢è©¦æŒ‘é¸', desc: 'ä¸çŸ¥é“å¦‚ä½•é¢è©¦æŒ‘é¸çœ‹è­·', x: 45, y: 40, cat: 'A' }, // Q3
  { id: 'A09', label: 'åˆç´„æ¢æ¬¾', desc: 'çœ‹è­·åˆç´„æ¢æ¬¾ä¸æ¸…æ¥š', x: 35, y: 30, cat: 'A' }, // Q3
  { id: 'A10', label: 'è¼ªç…§å…±è­˜', desc: 'å®¶äººè¼ªæµç…§é¡§ä½†ç¼ºä¹å…±è­˜', x: 85, y: 45, cat: 'A' }, // Q4
  { id: 'A11', label: 'æ‰‹è¶³åˆ†æ“”', desc: 'æ‰‹è¶³ä¸é¡˜åˆ†æ“”ç…§é¡§è²¬ä»»', x: 92, y: 40, cat: 'A' }, // Q4
  { id: 'A12', label: 'å®¶äººæŠ€èƒ½', desc: 'å®¶äººç…§é¡§æŠ€èƒ½ä¸è¶³', x: 30, y: 85, cat: 'A' }, // Q2
  { id: 'A13', label: 'ç¨è‡ªç…§é¡§', desc: 'ç¨è‡ªç…§é¡§ç„¡äººæ”¯æ´', x: 90, y: 95, cat: 'A' }, // Q1
  { id: 'A14', label: 'äººåŠ›ä¸­æ–·', desc: 'ç…§é¡§äººåŠ›çªç„¶ä¸­æ–·', x: 92, y: 96, cat: 'A' }, // Q1
  { id: 'A15', label: 'è¨“ç·´ç®¡ç†', desc: 'ä¸çŸ¥é“å¦‚ä½•è¨“ç·´æˆ–ç®¡ç†çœ‹è­·', x: 65, y: 60, cat: 'A' }, // Q1

  // B. ç…§é¡§æŠ€å·§
  { id: 'B01', label: 'å¤±æ™ºç…§é¡§', desc: 'ä¸äº†è§£å¤±æ™ºç—‡ç…§é¡§æŠ€å·§', x: 70, y: 92, cat: 'B' }, // Q1
  { id: 'B02', label: 'å”åŠ©æ´—æ¾¡', desc: 'ä¸çŸ¥é“å¦‚ä½•å”åŠ©é•·è¼©æ´—æ¾¡', x: 35, y: 65, cat: 'B' }, // Q2
  { id: 'B03', label: 'æŠ—æ‹’æ´—æ¾¡', desc: 'é•·è¼©æŠ—æ‹’æ´—æ¾¡æˆ–æ›´è¡£', x: 75, y: 55, cat: 'B' }, // Q1/Q4
  { id: 'B04', label: 'é¤µé£Ÿååš¥', desc: 'ä¸çŸ¥é“å¦‚ä½•é¤µé£Ÿååš¥å›°é›£è€…', x: 60, y: 95, cat: 'B' }, // Q1
  { id: 'B05', label: 'ç¿»èº«æ‹èƒŒ', desc: 'ä¸æœƒç¿»èº«æ‹èƒŒç­‰åŸºç¤ç…§è­·', x: 25, y: 70, cat: 'B' }, // Q2
  { id: 'B06', label: 'é é˜²å£“ç˜¡', desc: 'ä¸çŸ¥é“å¦‚ä½•é é˜²å£“ç˜¡', x: 30, y: 80, cat: 'B' }, // Q2
  { id: 'B07', label: 'ç®¡è·¯ç…§è­·', desc: 'ä¸äº†è§£é¼»èƒƒç®¡/å°¿ç®¡ç…§è­·', x: 55, y: 94, cat: 'B' }, // Q1
  { id: 'B08', label: 'å”åŠ©å¾©å¥', desc: 'ä¸çŸ¥é“å¦‚ä½•å”åŠ©å¾©å¥é‹å‹•', x: 45, y: 45, cat: 'B' }, // Q3
  { id: 'B09', label: 'è—¥ç‰©ç®¡ç†', desc: 'è—¥ç‰©ç®¡ç†æ··äº‚æˆ–å¿˜è¨˜çµ¦è—¥', x: 25, y: 85, cat: 'B' }, // Q2
  { id: 'B10', label: 'è§€å¯Ÿç—…æƒ…', desc: 'ä¸çŸ¥é“å¦‚ä½•è§€å¯Ÿç—…æƒ…è®ŠåŒ–', x: 60, y: 80, cat: 'B' }, // Q1
  { id: 'B11', label: 'ç·Šæ€¥è™•ç†', desc: 'ç·Šæ€¥ç‹€æ³ä¸çŸ¥å¦‚ä½•è™•ç†', x: 45, y: 98, cat: 'B' }, // Q2
  { id: 'B12', label: 'é é˜²è·Œå€’', desc: 'ä¸çŸ¥é“å¦‚ä½•é é˜²è·Œå€’', x: 30, y: 92, cat: 'B' }, // Q2
  { id: 'B13', label: 'ç‡Ÿé¤Šèª¿ç†', desc: 'ç‡Ÿé¤Šèª¿ç†ä¸çŸ¥å¾ä½•åšèµ·', x: 40, y: 40, cat: 'B' }, // Q3
  { id: 'B14', label: 'å‚·å£ç…§è­·', desc: 'å‚·å£ç…§è­·ä¸æœƒè™•ç†', x: 55, y: 90, cat: 'B' }, // Q1
  { id: 'B15', label: 'ä½¿ç”¨è¼”å…·', desc: 'ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨é†«ç™‚è¼”å…·', x: 35, y: 60, cat: 'B' }, // Q2

  // C. æºé€šèˆ‡æƒ…ç·’
  { id: 'C01', label: 'å¤±æ™ºæºé€š', desc: 'ç„¡æ³•å’Œå¤±æ™ºé•·è¼©æœ‰æ•ˆæºé€š', x: 80, y: 85, cat: 'C' }, // Q1
  { id: 'C02', label: 'æƒ…ç·’æš´èº', desc: 'é•·è¼©æƒ…ç·’æš´èºæ˜“æ€’', x: 75, y: 75, cat: 'C' }, // Q1
  { id: 'C03', label: 'å¦„æƒ³å¹»è¦º', desc: 'é•·è¼©å‡ºç¾å¦„æƒ³æˆ–å¹»è¦º', x: 85, y: 82, cat: 'C' }, // Q1
  { id: 'C04', label: 'é‡è¤‡å•è©±', desc: 'é•·è¼©é‡è¤‡å•åŒæ¨£å•é¡Œ', x: 65, y: 35, cat: 'C' }, // Q4
  { id: 'C05', label: 'ä¸é…åˆç…§', desc: 'é•·è¼©ä¸é…åˆç…§é¡§', x: 80, y: 88, cat: 'C' }, // Q1
  { id: 'C06', label: 'æ‡·ç–‘è¢«å·', desc: 'é•·è¼©æ‡·ç–‘æ±è¥¿è¢«å·', x: 70, y: 40, cat: 'C' }, // Q4
  { id: 'C07', label: 'å®‰æ’«æƒ…ç·’', desc: 'ä¸çŸ¥é“å¦‚ä½•å®‰æ’«é•·è¼©æƒ…ç·’', x: 60, y: 75, cat: 'C' }, // Q1
  { id: 'C08', label: 'æ—¥å¤œé¡›å€’', desc: 'é•·è¼©æ—¥å¤œé¡›å€’åµé¬§', x: 75, y: 85, cat: 'C' }, // Q1
  { id: 'C09', label: 'æ‹’çµ•å°±é†«', desc: 'é•·è¼©æ‹’çµ•å°±é†«æˆ–æœè—¥', x: 85, y: 90, cat: 'C' }, // Q1
  { id: 'C10', label: 'å®¶äººä¸åˆ', desc: 'å®¶äººå°ç…§é¡§æ–¹å¼æ„è¦‹ä¸åˆ', x: 90, y: 45, cat: 'C' }, // Q4
  { id: 'C11', label: 'èªªæœä½¿ç”¨', desc: 'ç„¡æ³•èªªæœé•·è¼©ä½¿ç”¨è³‡æº', x: 80, y: 48, cat: 'C' }, // Q4
  { id: 'C12', label: 'æ€§æ ¼æ”¹è®Š', desc: 'é•·è¼©æ€§æ ¼æ”¹è®Šé›£ä»¥ç›¸è™•', x: 70, y: 30, cat: 'C' }, // Q4

  // D. é•·ç…§è³‡æº
  { id: 'D01', label: 'è³‡æºèªçŸ¥', desc: 'ä¸çŸ¥é“æœ‰å“ªäº›é•·ç…§è³‡æºå¯ç”¨', x: 20, y: 45, cat: 'D' }, // Q3
  { id: 'D02', label: 'ç”³è«‹æœå‹™', desc: 'ä¸çŸ¥é“å¦‚ä½•ç”³è«‹é•·ç…§æœå‹™', x: 25, y: 85, cat: 'D' }, // Q2
  { id: 'D03', label: 'æµç¨‹è¤‡é›œ', desc: 'é•·ç…§ç”³è«‹æµç¨‹å¤ªè¤‡é›œ', x: 50, y: 60, cat: 'D' }, // Q1/Q2
  { id: 'D04', label: 'è£œåŠ©è³‡æ ¼', desc: 'ä¸çŸ¥é“è‡ªå·±ç¬¦åˆå“ªäº›è£œåŠ©', x: 30, y: 40, cat: 'D' }, // Q3
  { id: 'D05', label: 'é¡åº¦ä¸è¶³', desc: 'é•·ç…§é¡åº¦ä¸å¤ ç”¨', x: 85, y: 88, cat: 'D' }, // Q1
  { id: 'D06', label: 'æ—¥ç…§ä¸­å¿ƒ', desc: 'æ‰¾ä¸åˆ°é©åˆçš„æ—¥ç…§ä¸­å¿ƒ', x: 60, y: 75, cat: 'D' }, // Q1
  { id: 'D07', label: 'èº«éšœè­‰æ˜', desc: 'ä¸çŸ¥é“å¦‚ä½•ç”³è«‹èº«å¿ƒéšœç¤™è­‰æ˜', x: 35, y: 35, cat: 'D' }, // Q3
  { id: 'D08', label: 'è¼”å…·ç§Ÿè³¼', desc: 'è¼”å…·ç§Ÿå€Ÿæˆ–è³¼è²·ä¸çŸ¥å¾ä½•æ‰¾èµ·', x: 25, y: 30, cat: 'D' }, // Q3
  { id: 'D09', label: 'ç„¡éšœæ”¹é€ ', desc: 'å±…å®¶ç„¡éšœç¤™æ”¹é€ ä¸çŸ¥é“æ€éº¼åš', x: 55, y: 65, cat: 'D' }, // Q1
  { id: 'D10', label: 'å–˜æ¯ä½¿ç”¨', desc: 'ä¸äº†è§£å–˜æ¯æœå‹™æ€éº¼ç”¨', x: 25, y: 70, cat: 'D' }, // Q2
  { id: 'D11', label: 'é€é¤æœå‹™', desc: 'é€é¤æœå‹™æ‰¾ä¸åˆ°æˆ–ä¸åˆèƒƒå£', x: 30, y: 25, cat: 'D' }, // Q3
  { id: 'D12', label: 'äº¤é€šæ¥é€', desc: 'äº¤é€šæ¥é€è³‡æºä¸è¶³', x: 70, y: 80, cat: 'D' }, // Q1

  // E. é†«ç™‚ç…§è­·
  { id: 'E01', label: 'ç§‘åˆ¥é¸æ“‡', desc: 'ä¸çŸ¥é“è©²çœ‹å“ªä¸€ç§‘', x: 15, y: 30, cat: 'E' }, // Q3
  { id: 'E02', label: 'å°‹æ‰¾é†«é™¢', desc: 'æ‰¾ä¸åˆ°å¥½çš„é†«å¸«æˆ–é†«é™¢', x: 45, y: 60, cat: 'E' }, // Q2
  { id: 'E03', label: 'å°±é†«å¾€è¿”', desc: 'é »ç¹å°±é†«å¾€è¿”å¤ªè¾›è‹¦', x: 65, y: 70, cat: 'E' }, // Q1
  { id: 'E04', label: 'å‡ºé™¢éŠœæ¥', desc: 'å‡ºé™¢æº–å‚™ä¸çŸ¥é“å¦‚ä½•éŠœæ¥', x: 70, y: 95, cat: 'E' }, // Q1
  { id: 'E05', label: 'ä½é™¢äººåŠ›', desc: 'ä½é™¢ç…§è­·äººåŠ›ä¸è¶³', x: 85, y: 92, cat: 'E' }, // Q1
  { id: 'E06', label: 'é†«ç™‚è²»ç”¨', desc: 'é†«ç™‚è²»ç”¨è² æ“”éé‡', x: 80, y: 88, cat: 'E' }, // Q1
  { id: 'E07', label: 'ç—…æƒ…äº†è§£', desc: 'ä¸äº†è§£ç—…æƒ…èˆ‡æ²»ç™‚é¸é …', x: 50, y: 75, cat: 'E' }, // Q1
  { id: 'E08', label: 'è—¥ç‰©å‰¯ä½œ', desc: 'è—¥ç‰©å‰¯ä½œç”¨é›£ä»¥è™•ç†', x: 60, y: 65, cat: 'E' }, // Q1
  { id: 'E09', label: 'æŠ—æ‹’å›è¨º', desc: 'é•·è¼©æŠ—æ‹’å›è¨ºæˆ–æª¢æŸ¥', x: 75, y: 70, cat: 'E' }, // Q1
  { id: 'E10', label: 'é†«ç—…æºé€š', desc: 'é†«ç—…æºé€šå›°é›£', x: 65, y: 60, cat: 'E' }, // Q1

  // F. å±…å®¶å®‰å…¨
  { id: 'F01', label: 'æ“”å¿ƒèµ°å¤±', desc: 'æ“”å¿ƒé•·è¼©èµ°å¤±', x: 60, y: 95, cat: 'F' }, // Q1
  { id: 'F02', label: 'ç’°å¢ƒè·Œå€’', desc: 'å®¶ä¸­ç’°å¢ƒå®¹æ˜“è·Œå€’', x: 40, y: 92, cat: 'F' }, // Q2
  { id: 'F03', label: 'ç“¦æ–¯å®‰å…¨', desc: 'é•·è¼©ç¨è‡ªæ“ä½œç“¦æ–¯ä¸å®‰å…¨', x: 50, y: 90, cat: 'F' }, // Q1
  { id: 'F04', label: 'æµ´å®¤æ¿•æ»‘', desc: 'æµ´å®¤æ¿•æ»‘å±éšª', x: 30, y: 88, cat: 'F' }, // Q2
  { id: 'F05', label: 'å¤œé–“éŠèµ°', desc: 'é•·è¼©åŠå¤œéŠèµ°æœ‰å±éšª', x: 70, y: 90, cat: 'F' }, // Q1
  { id: 'F06', label: 'å‹•ç·šä¸é©', desc: 'å®¶ä¸­å‹•ç·šä¸é©åˆè¼ªæ¤…/åŠ©è¡Œå™¨', x: 55, y: 75, cat: 'F' }, // Q1
  { id: 'F07', label: 'ç·Šæ€¥å‘¼å«', desc: 'æ²’æœ‰ç·Šæ€¥å‘¼å«ç³»çµ±', x: 20, y: 85, cat: 'F' }, // Q2
  { id: 'F08', label: 'é–€æª»å‡ºå…¥', desc: 'é–€æª»å¤ªé«˜å‡ºå…¥ä¸ä¾¿', x: 35, y: 60, cat: 'F' }, // Q2

  // G. è²¡å‹™æ³•å¾‹
  { id: 'G01', label: 'è²»ç”¨è² æ“”', desc: 'ç…§é¡§è²»ç”¨é¾å¤§ä¸çŸ¥å¦‚ä½•è² æ“”', x: 90, y: 98, cat: 'G' }, // Q1
  { id: 'G02', label: 'è²¡ç”¢è©é¨™', desc: 'æ“”å¿ƒé•·è¼©è²¡ç”¢è¢«è©é¨™', x: 75, y: 85, cat: 'G' }, // Q1
  { id: 'G03', label: 'è²¡ç”¢ä¿è­·', desc: 'ä¸çŸ¥é“å¦‚ä½•åšè²¡ç”¢ä¿è­·', x: 65, y: 70, cat: 'G' }, // Q1
  { id: 'G04', label: 'ç›£è­·å®£å‘Š', desc: 'éœ€è¦ç”³è«‹ç›£è­·å®£å‘Šä½†ä¸çŸ¥å¦‚ä½•é€²è¡Œ', x: 70, y: 60, cat: 'G' }, // Q1/Q4
  { id: 'G05', label: 'éºç”¢è¦åŠƒ', desc: 'éºç”¢è¦åŠƒä¸çŸ¥å¾ä½•é–‹å§‹', x: 65, y: 40, cat: 'G' }, // Q4
  { id: 'G06', label: 'æ„å®šç›£è­·', desc: 'ä¸äº†è§£æ„å®šç›£è­·', x: 60, y: 35, cat: 'G' }, // Q4
  { id: 'G07', label: 'å¸³æˆ¶ç®¡ç†', desc: 'é•·è¼©å¸³æˆ¶ç®¡ç†æ··äº‚', x: 50, y: 45, cat: 'G' }, // Q3/Q4
  { id: 'G08', label: 'è²»ç”¨å ±ç¨…', desc: 'é†«ç™‚è²»ç”¨å ±ç¨…ä¸æ¸…æ¥š', x: 25, y: 25, cat: 'G' }, // Q3
  { id: 'G09', label: 'ä¿éšªç†è³ ', desc: 'ä¿éšªç†è³ ç”³è«‹å›°é›£', x: 60, y: 55, cat: 'G' }, // Q1/Q4
  { id: 'G10', label: 'è²¡ç”¢çˆ­è­°', desc: 'æ‰‹è¶³å°è²¡ç”¢åˆ†é…æœ‰çˆ­è­°', x: 95, y: 45, cat: 'G' }, // Q4

  // H. æ©Ÿæ§‹å®‰ç½®
  { id: 'H01', label: 'é¸æ“‡æ©Ÿæ§‹', desc: 'ä¸çŸ¥é“å¦‚ä½•é¸æ“‡é©åˆçš„æ©Ÿæ§‹', x: 50, y: 85, cat: 'H' }, // Q1
  { id: 'H02', label: 'æ©Ÿæ§‹è²»ç”¨', desc: 'æ©Ÿæ§‹è²»ç”¨å¤ªé«˜', x: 85, y: 90, cat: 'H' }, // Q1
  { id: 'H03', label: 'ç©ºåºŠå°‹æ‰¾', desc: 'æ‰¾ä¸åˆ°æœ‰ç©ºåºŠä½çš„æ©Ÿæ§‹', x: 80, y: 88, cat: 'H' }, // Q1
  { id: 'H04', label: 'ç…§é¡§å“è³ª', desc: 'æ“”å¿ƒæ©Ÿæ§‹ç…§é¡§å“è³ª', x: 65, y: 92, cat: 'H' }, // Q1
  { id: 'H05', label: 'æŠ—æ‹’å…¥ä½', desc: 'é•·è¼©æŠ—æ‹’å…¥ä½æ©Ÿæ§‹', x: 85, y: 80, cat: 'H' }, // Q1
  { id: 'H06', label: 'å®¶äººåˆ†æ­§', desc: 'å®¶äººå°æ˜¯å¦é€æ©Ÿæ§‹æ„è¦‹åˆ†æ­§', x: 80, y: 48, cat: 'H' }, // Q4
  { id: 'H07', label: 'åƒè§€è©¢å•', desc: 'åƒè§€æ©Ÿæ§‹ä¸çŸ¥é“è©²å•ä»€éº¼', x: 35, y: 35, cat: 'H' }, // Q3
  { id: 'H08', label: 'è©•ä¼°æ©Ÿæ§‹', desc: 'ä¸çŸ¥é“å¦‚ä½•è©•ä¼°æ©Ÿæ§‹å¥½å£', x: 55, y: 70, cat: 'H' }, // Q1

  // I. ç…§é¡§è€…è‡ªæˆ‘
  { id: 'I01', label: 'å£“åŠ›å´©æ½°', desc: 'ç…§é¡§å£“åŠ›å¤§æƒ…ç·’å´©æ½°', x: 85, y: 98, cat: 'I' }, // Q1
  { id: 'I02', label: 'æ²’æœ‰æ™‚é–“', desc: 'æ²’æœ‰è‡ªå·±çš„æ™‚é–“', x: 80, y: 85, cat: 'I' }, // Q1
  { id: 'I03', label: 'å¥åº·å•é¡Œ', desc: 'èº«é«”å‡ºç¾å¥åº·å•é¡Œ', x: 75, y: 90, cat: 'I' }, // Q1
  { id: 'I04', label: 'å­¤å–®ç„¡åŠ©', desc: 'è¦ºå¾—å­¤å–®ç„¡äººç†è§£', x: 65, y: 80, cat: 'I' }, // Q1
  { id: 'I05', label: 'ç¡çœ å“è³ª', desc: 'ç¡çœ å“è³ªå¾ˆå·®', x: 70, y: 92, cat: 'I' }, // Q1
  { id: 'I06', label: 'å·¥ä½œå¹³è¡¡', desc: 'å·¥ä½œèˆ‡ç…§é¡§é›£ä»¥å¹³è¡¡', x: 88, y: 90, cat: 'I' }, // Q1
  { id: 'I07', label: 'ç´“å£“æ–¹å¼', desc: 'ä¸çŸ¥é“å¦‚ä½•ç´“å£“', x: 45, y: 40, cat: 'I' }, // Q3
  { id: 'I08', label: 'æ„§ç–šè‡ªè²¬', desc: 'æ„Ÿåˆ°æ„§ç–šæˆ–è‡ªè²¬', x: 60, y: 65, cat: 'I' }, // Q1

  // J. é ç«‹é†«ç™‚
  { id: 'J01', label: 'é ç«‹é†«ç™‚', desc: 'ä¸äº†è§£é ç«‹é†«ç™‚æ±ºå®š', x: 50, y: 60, cat: 'J' }, // Q1/Q3
  { id: 'J02', label: 'å–„çµ‚è¨è«–', desc: 'ä¸çŸ¥é“å¦‚ä½•å’Œå®¶äººè¨è«–å–„çµ‚è­°é¡Œ', x: 75, y: 70, cat: 'J' }, // Q1
];

const categories = {
  A: 'äººåŠ›è³‡æºå•é¡Œ',
  B: 'ç…§é¡§æŠ€å·§èˆ‡çŸ¥è­˜',
  C: 'æºé€šèˆ‡æƒ…ç·’å•é¡Œ',
  D: 'é•·ç…§è³‡æºèˆ‡ç”³è«‹',
  E: 'é†«ç™‚ç…§è­·å•é¡Œ',
  F: 'å±…å®¶å®‰å…¨å•é¡Œ',
  G: 'è²¡å‹™æ³•å¾‹å•é¡Œ',
  H: 'æ©Ÿæ§‹å®‰ç½®å•é¡Œ',
  I: 'ç…§é¡§è€…è‡ªæˆ‘ç…§é¡§',
  J: 'é ç«‹é†«ç™‚èˆ‡å–„çµ‚',
};

// è±¡é™å®šç¾©
const QUADRANTS = {
  Q1: { title: 'å±æ©Ÿè™•ç†å€ (é«˜é‡è¦/é«˜é›£åº¦)', color: 'bg-red-100 border-red-300 text-red-800', dotColor: '#EF4444' },
  Q2: { title: 'å„ªå…ˆæ”¹å–„å€ (é«˜é‡è¦/ä½é›£åº¦)', color: 'bg-yellow-100 border-yellow-300 text-yellow-800', dotColor: '#F59E0B' },
  Q3: { title: 'æ—¥å¸¸ç¶­è­·å€ (ä½é‡è¦/ä½é›£åº¦)', color: 'bg-green-100 border-green-300 text-green-800', dotColor: '#10B981' },
  Q4: { title: 'é•·æœŸè¦åŠƒå€ (ä½é‡è¦/é«˜é›£åº¦)', color: 'bg-blue-100 border-blue-300 text-blue-800', dotColor: '#3B82F6' },
};

const getQuadrant = (x, y) => {
  if (x >= 50 && y >= 50) return 'Q1';
  if (x < 50 && y >= 50) return 'Q2';
  if (x < 50 && y < 50) return 'Q3';
  return 'Q4';
};

export default function LtcAnalysisApp() {
  const [currentStep, setCurrentStep] = useState('survey'); // survey, analysis, admin, report
  // å°‡ questionsData è¨­ç‚º Stateï¼Œä½¿å…¶å¯ç·¨è¼¯
  const [questionsData, setQuestionsData] = useState(INITIAL_DATA);
  const [selectedIssues, setSelectedIssues] = useState(new Set());
  const [showAll, setShowAll] = useState(false);
  const [hoveredPoint, setHoveredPoint] = useState(null);

  // æ¨¡æ“¬å¾Œç«¯è³‡æ–™åº«
  const [knowledgeBase, setKnowledgeBase] = useState(() => {
    const defaultLink = 'https://docs.google.com/presentation/d/12jtqOgifk8INhK26MNmwKupScSR3GqEgEErThAp4Wek/edit?usp=sharing';
    const initialKb = {};
    INITIAL_DATA.forEach(item => {
      initialKb[item.id] = defaultLink;
    });
    return initialKb;
  });

  // Admin Search State
  const [adminSearch, setAdminSearch] = useState('');

  const toggleIssue = (id) => {
    const newSet = new Set(selectedIssues);
    if (newSet.has(id)) {
      newSet.delete(id);
    } else {
      newSet.add(id);
    }
    setSelectedIssues(newSet);
  };

  const selectAllInCategory = (catKey) => {
    const newSet = new Set(selectedIssues);
    const catItems = questionsData.filter(i => i.cat === catKey);
    const allSelected = catItems.every(i => newSet.has(i.id));
    
    catItems.forEach(i => {
      if (allSelected) newSet.delete(i.id);
      else newSet.add(i.id);
    });
    setSelectedIssues(newSet);
  };

  const handleFinishSurvey = () => {
    if (selectedIssues.size === 0) {
      alert("è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å•é¡Œ");
      return;
    }
    setCurrentStep('analysis');
    setShowAll(false);
  };

  const handleUpdateQuestion = (id, field, value) => {
    setQuestionsData(prevData => 
      prevData.map(item => {
        if (item.id === id) {
          if (field === 'x' || field === 'y') {
            const numVal = parseInt(value, 10);
            return { ...item, [field]: isNaN(numVal) ? 0 : Math.min(100, Math.max(0, numVal)) };
          }
          return { ...item, [field]: value };
        }
        return item;
      })
    );
  };

  const handleUpdateLink = (id, url) => {
    setKnowledgeBase(prev => ({
      ...prev,
      [id]: url
    }));
  };

  const handleConnectDrive = () => {
    alert("ã€æ¨¡æ“¬ç³»çµ±æç¤ºã€‘\nå·²æˆåŠŸé€£çµè‡³ Google Drive å¸³è™Ÿï¼šuser@example.com\n\næ³¨æ„ï¼šé€™æ˜¯ä¸€å€‹å‰ç«¯æ¼”ç¤ºï¼Œå¯¦éš›æ‡‰ç”¨éœ€è¦å¾Œç«¯ API æ•´åˆ OAuth é©—è­‰ã€‚");
  };

  const handlePrint = () => {
    window.print();
  };

  // --- ç•«é¢æ¸²æŸ“é‚è¼¯ ---

  // 1. å ±å‘Šé è¦½ç•«é¢ (New Feature)
  if (currentStep === 'report') {
    const date = new Date().toLocaleDateString('zh-TW');
    const q1Issues = questionsData.filter(i => selectedIssues.has(i.id) && getQuadrant(i.x, i.y) === 'Q1');
    const q2Issues = questionsData.filter(i => selectedIssues.has(i.id) && getQuadrant(i.x, i.y) === 'Q2');

    return (
      <div className="max-w-4xl mx-auto min-h-screen bg-gray-50 font-sans print:bg-white print:p-0">
        {/* æ§åˆ¶åˆ— (åˆ—å°æ™‚éš±è—) */}
        <div className="p-4 flex justify-between items-center bg-gray-800 text-white shadow-lg mb-8 print:hidden sticky top-0 z-50 rounded-b-lg">
          <div className="flex items-center gap-4">
             <button 
                onClick={() => setCurrentStep('analysis')}
                className="flex items-center gap-2 text-gray-300 hover:text-white transition-colors"
             >
                <ChevronLeft size={20} /> è¿”å›åˆ†æ
             </button>
             <h2 className="font-bold text-lg border-l border-gray-600 pl-4">å ±å‘Šé è¦½æ¨¡å¼</h2>
          </div>
          <button 
            onClick={handlePrint}
            className="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-500 text-white px-6 py-2 rounded-full font-bold shadow-md transition-all"
          >
            <Printer size={18} /> åˆ—å° / å­˜ç‚º PDF
          </button>
        </div>

        {/* å ±å‘Šæœ¬é«” (A4 æ¨¡æ“¬æ¨£å¼) */}
        <div className="bg-white shadow-2xl print:shadow-none mx-auto w-full max-w-[210mm] p-[10mm] min-h-[297mm] box-border">
           
           {/* å ±å‘Šé é¦– */}
           <header className="border-b-2 border-indigo-600 pb-4 mb-6 flex justify-between items-end">
              <div>
                 <h1 className="text-3xl font-bold text-gray-800 mb-1">é•·ç…§å›°å¢ƒåˆ†æå ±å‘Š</h1>
                 <p className="text-gray-500 text-sm">è‡ªæˆ‘æª¢æ¸¬èˆ‡è¡Œå‹•è¨ˆç•«å·¥ä½œè¡¨</p>
              </div>
              <div className="text-right">
                 <div className="text-sm text-gray-500">æª¢æ¸¬æ—¥æœŸ</div>
                 <div className="font-bold text-gray-800 text-lg">{date}</div>
              </div>
           </header>

           {/* æ‘˜è¦æ•¸æ“š */}
           <section className="bg-gray-50 rounded-lg p-4 mb-6 flex justify-between items-center print:bg-gray-100">
              <div className="text-sm text-gray-600">
                 æ‚¨åœ¨ <span className="font-bold text-gray-900">{selectedIssues.size}</span> å€‹é …ç›®ä¸­è¡¨ç¤ºé¢è‡¨æŒ‘æˆ°ã€‚
                 <br/>ä»¥ä¸‹åˆ†æåœ–è¡¨å”åŠ©æ‚¨èšç„¦å•é¡Œçš„å„ªå…ˆé †åºã€‚
              </div>
              <div className="flex gap-4">
                 <div className="text-center">
                    <span className="block font-bold text-red-600 text-xl">{q1Issues.length}</span>
                    <span className="text-xs text-gray-500">å±æ©Ÿè™•ç†</span>
                 </div>
                 <div className="text-center">
                    <span className="block font-bold text-yellow-600 text-xl">{q2Issues.length}</span>
                    <span className="text-xs text-gray-500">å„ªå…ˆæ”¹å–„</span>
                 </div>
              </div>
           </section>

           {/* åœ–è¡¨èˆ‡é‡é»æ¸…å–®ä¸¦æ’ */}
           <div className="flex flex-col md:flex-row gap-6 mb-8">
              {/* éœæ…‹ SVG åœ–è¡¨ */}
              <div className="w-full md:w-1/2 aspect-square bg-white border border-gray-200 rounded-lg relative">
                 <div className="absolute inset-2 grid grid-cols-2 grid-rows-2">
                    <div className="border-r border-b border-gray-200 p-1"><span className="text-[10px] text-yellow-600 font-bold bg-yellow-50 px-1">å„ªå…ˆæ”¹å–„</span></div>
                    <div className="border-b border-gray-200 p-1 text-right"><span className="text-[10px] text-red-600 font-bold bg-red-50 px-1">å±æ©Ÿè™•ç†</span></div>
                    <div className="border-r border-gray-200 p-1 flex items-end"><span className="text-[10px] text-green-600 font-bold bg-green-50 px-1">æ—¥å¸¸ç¶­è­·</span></div>
                    <div className="p-1 flex items-end justify-end"><span className="text-[10px] text-blue-600 font-bold bg-blue-50 px-1">é•·æœŸè¦åŠƒ</span></div>
                 </div>
                 <svg viewBox="0 0 110 110" className="w-full h-full relative z-10">
                    <line x1="5" y1="55" x2="105" y2="55" stroke="#cbd5e1" strokeWidth="0.5" />
                    <line x1="55" y1="105" x2="55" y2="5" stroke="#cbd5e1" strokeWidth="0.5" />
                    {questionsData.map((item) => {
                      if (!selectedIssues.has(item.id)) return null;
                      const quad = getQuadrant(item.x, item.y);
                      const color = QUADRANTS[quad].dotColor;
                      return (
                        <circle 
                          key={item.id}
                          cx={item.x} 
                          cy={100 - item.y + 5} 
                          r="2" 
                          fill={color}
                          stroke="white"
                          strokeWidth="0.5"
                        />
                      );
                    })}
                 </svg>
              </div>

              {/* å„ªå…ˆå•é¡Œæ¸…å–® */}
              <div className="w-full md:w-1/2">
                 <h3 className="font-bold text-gray-800 border-b-2 border-red-200 pb-2 mb-3">ğŸ”¥ éœ€å„ªå…ˆé—œæ³¨çš„å•é¡Œ</h3>
                 {q1Issues.length === 0 && q2Issues.length === 0 ? (
                    <p className="text-gray-500 text-sm">æ­å–œï¼ç›®å‰æ²’æœ‰è½å…¥é«˜é¢¨éšªè±¡é™çš„å•é¡Œã€‚</p>
                 ) : (
                    <ul className="space-y-2 text-sm">
                       {q1Issues.slice(0, 5).map(item => (
                          <li key={item.id} className="flex items-start gap-2">
                             <span className="text-red-500 font-bold min-w-[3.5em]">[å±æ©Ÿ]</span>
                             <span className="text-gray-800">{item.label}</span>
                          </li>
                       ))}
                       {q2Issues.slice(0, 5).map(item => (
                          <li key={item.id} className="flex items-start gap-2">
                             <span className="text-yellow-500 font-bold min-w-[3.5em]">[å„ªå…ˆ]</span>
                             <span className="text-gray-800">{item.label}</span>
                          </li>
                       ))}
                       {(q1Issues.length + q2Issues.length) > 10 && (
                          <li className="text-gray-500 italic pt-1">...ä»¥åŠå…¶ä»– {q1Issues.length + q2Issues.length - 10} é …å•é¡Œ</li>
                       )}
                    </ul>
                 )}
              </div>
           </div>

           {/* ç…§é¡§é ˜åŸŸç•™ç™½ç­†è¨˜å€ */}
           <div className="mb-4">
              <h3 className="font-bold text-gray-800 text-lg mb-4 flex items-center gap-2">
                 <Edit3 size={20} /> ç…§é¡§è¨ˆç•«èˆ‡ç­†è¨˜å·¥ä½œè¡¨
              </h3>
              <p className="text-xs text-gray-500 mb-4">è«‹åˆ©ç”¨ä¸‹æ–¹ç©ºé–“ï¼Œé‡å°å››å¤§ç…§é¡§é ˜åŸŸè¨˜éŒ„æ‚¨çš„ç¾æ³ç›¤é»ã€è³‡æºéœ€æ±‚æˆ–ä¸‹ä¸€æ­¥è¡Œå‹•è¨ˆç•«ã€‚</p>
              
              <div className="grid grid-cols-2 gap-6">
                 {/* 1. é†«ç™‚èˆ‡è­·ç† */}
                 <div className="border-2 border-gray-200 rounded-lg p-3 min-h-[160px]">
                    <div className="font-bold text-gray-700 mb-2 border-b border-gray-200 pb-1">ğŸ¥ é†«ç™‚èˆ‡è­·ç†éœ€æ±‚</div>
                    <div className="w-full h-full min-h-[120px] border-none bg-[linear-gradient(transparent_23px,#e5e7eb_24px)] bg-[length:100%_24px] text-gray-600 text-sm leading-[24px]">
                       {/* æ©«ç·šèƒŒæ™¯ä¾›æ›¸å¯« */}
                    </div>
                 </div>

                 {/* 2. ç”Ÿæ´»èˆ‡å®‰å…¨ */}
                 <div className="border-2 border-gray-200 rounded-lg p-3 min-h-[160px]">
                    <div className="font-bold text-gray-700 mb-2 border-b border-gray-200 pb-1">ğŸ  ç”Ÿæ´»ç…§é¡§èˆ‡å®‰å…¨ç’°å¢ƒ</div>
                    <div className="w-full h-full min-h-[120px] border-none bg-[linear-gradient(transparent_23px,#e5e7eb_24px)] bg-[length:100%_24px] text-gray-600 text-sm leading-[24px]">
                    </div>
                 </div>

                 {/* 3. å®¶åº­èˆ‡æºé€š */}
                 <div className="border-2 border-gray-200 rounded-lg p-3 min-h-[160px]">
                    <div className="font-bold text-gray-700 mb-2 border-b border-gray-200 pb-1">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶åº­æºé€šèˆ‡è²¡å‹™</div>
                    <div className="w-full h-full min-h-[120px] border-none bg-[linear-gradient(transparent_23px,#e5e7eb_24px)] bg-[length:100%_24px] text-gray-600 text-sm leading-[24px]">
                    </div>
                 </div>

                 {/* 4. ç…§é¡§è€…è‡ªæˆ‘èª¿é© */}
                 <div className="border-2 border-gray-200 rounded-lg p-3 min-h-[160px]">
                    <div className="font-bold text-gray-700 mb-2 border-b border-gray-200 pb-1">â˜• ç…§é¡§è€…èº«å¿ƒèª¿é©</div>
                    <div className="w-full h-full min-h-[120px] border-none bg-[linear-gradient(transparent_23px,#e5e7eb_24px)] bg-[length:100%_24px] text-gray-600 text-sm leading-[24px]">
                    </div>
                 </div>
              </div>
           </div>

           {/* é å°¾ */}
           <footer className="mt-8 text-center text-xs text-gray-400 border-t border-gray-100 pt-4">
              <p>æœ¬å ±å‘Šç”±ã€Œé•·ç…§å›°å¢ƒè¨ºæ–·é›·é”ã€ç”Ÿæˆã€‚è©•ä¼°çµæœåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›ç…§é¡§è¨ˆç•«è«‹è«®è©¢å°ˆæ¥­äººå“¡ã€‚</p>
           </footer>

        </div>
      </div>
    );
  }

  // 2. Admin ç•«é¢
  if (currentStep === 'admin') {
    const filteredData = questionsData.filter(item => 
      item.label.includes(adminSearch) || 
      item.desc.includes(adminSearch) ||
      item.id.includes(adminSearch)
    );

    return (
      <div className="max-w-7xl mx-auto p-4 bg-gray-50 min-h-screen font-sans">
        <header className="bg-white p-6 rounded-xl shadow-sm mb-6 flex justify-between items-center border-l-8 border-indigo-600">
          <div>
            <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2">
              <Settings className="text-indigo-600" /> çŸ¥è­˜åº«å…§å®¹èˆ‡åº§æ¨™ç®¡ç†
            </h1>
            <p className="text-gray-500 text-sm mt-1">ç®¡ç†æ¯å€‹å•é¡Œçš„åç¨±ã€æè¿°ã€é›£æ˜“åº¦/é‡è¦æ€§åº§æ¨™èˆ‡å°æ‡‰ç°¡å ±é€£çµ</p>
          </div>
          <button 
            onClick={() => setCurrentStep('analysis')}
            className="flex items-center gap-2 text-gray-600 hover:text-indigo-600 transition-colors px-4 py-2 border rounded-lg bg-gray-50 hover:bg-white"
          >
            <RotateCcw size={16} /> è¿”å›åˆ†æä»‹é¢
          </button>
        </header>

        {/* é€£çµ Drive å€å¡Š */}
        <div className="bg-white p-6 rounded-xl shadow-sm mb-6 border border-gray-200">
           <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                 <div className="bg-green-100 p-3 rounded-full">
                    <Cloud className="text-green-600" size={24} />
                 </div>
                 <div>
                    <h3 className="font-bold text-gray-800">è³‡æ–™ä¾†æºé€£çµ</h3>
                    <p className="text-sm text-gray-500">é€£çµ Google Drive ä»¥ç›´æ¥é¸å–æª”æ¡ˆ (æ¨¡æ“¬)</p>
                 </div>
              </div>
              <button 
                onClick={handleConnectDrive}
                className="bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-lg font-medium flex items-center gap-2 shadow-sm"
              >
                <img src="https://upload.wikimedia.org/wikipedia/commons/1/12/Google_Drive_icon_%282020%29.svg" alt="Drive" className="w-5 h-5"/>
                é€£çµ Google Drive
              </button>
           </div>
        </div>

        {/* æœå°‹èˆ‡åˆ—è¡¨ */}
        <div className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
          <div className="p-4 border-b border-gray-100 bg-gray-50 flex items-center gap-4">
             <div className="relative flex-1">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={18} />
                <input 
                  type="text" 
                  placeholder="æœå°‹å•é¡Œç·¨è™Ÿã€åç¨±æˆ–æè¿°..." 
                  className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                  value={adminSearch}
                  onChange={(e) => setAdminSearch(e.target.value)}
                />
             </div>
             <div className="text-sm text-gray-500">é¡¯ç¤º {filteredData.length} ç­†è³‡æ–™</div>
          </div>

          <div className="overflow-x-auto">
            <table className="w-full text-left border-collapse">
              <thead>
                <tr className="bg-gray-100 text-gray-600 text-sm font-bold border-b border-gray-200">
                  <th className="p-4 w-20">ç·¨è™Ÿ</th>
                  <th className="p-4 w-64">å•é¡Œå…§å®¹ç·¨è¼¯ (åç¨±/å‚™è¨»)</th>
                  <th className="p-4 w-40">åº§æ¨™è¨­å®š (0-100)</th>
                  <th className="p-4">çŸ¥è­˜ç°¡å ±é€£çµ (URL)</th>
                  <th className="p-4 w-20 text-center">ç‹€æ…‹</th>
                </tr>
              </thead>
              <tbody className="text-sm">
                {filteredData.map(item => (
                  <tr key={item.id} className="border-b border-gray-100 hover:bg-gray-50 transition-colors group">
                    <td className="p-4 font-mono text-gray-500 align-top pt-5">{item.id}</td>
                    
                    {/* å•é¡Œå…§å®¹ç·¨è¼¯å€ */}
                    <td className="p-4 align-top">
                      <div className="flex flex-col gap-2">
                        <div className="flex items-center gap-2">
                          <span className="text-xs font-bold text-gray-400 w-8">åç¨±</span>
                          <input 
                            type="text" 
                            className="font-bold text-gray-800 border border-gray-200 rounded px-2 py-1 w-full focus:ring-1 focus:ring-indigo-500 focus:outline-none"
                            value={item.label}
                            onChange={(e) => handleUpdateQuestion(item.id, 'label', e.target.value)}
                          />
                        </div>
                        <div className="flex items-start gap-2">
                          <span className="text-xs font-bold text-gray-400 w-8 mt-1">å‚™è¨»</span>
                          <textarea 
                            className="text-xs text-gray-600 border border-gray-200 rounded px-2 py-1 w-full h-16 resize-none focus:ring-1 focus:ring-indigo-500 focus:outline-none"
                            value={item.desc}
                            onChange={(e) => handleUpdateQuestion(item.id, 'desc', e.target.value)}
                          />
                        </div>
                      </div>
                    </td>

                    {/* åº§æ¨™è¨­å®šå€ */}
                    <td className="p-4 align-top">
                      <div className="flex flex-col gap-2">
                         <div className="flex items-center justify-between bg-gray-50 p-1.5 rounded border border-gray-200">
                            <span className="text-xs text-gray-500 font-mono">X(é›£)</span>
                            <input 
                              type="number" 
                              min="0" max="100"
                              className="w-12 text-center text-sm border-gray-300 rounded focus:ring-indigo-500"
                              value={item.x}
                              onChange={(e) => handleUpdateQuestion(item.id, 'x', e.target.value)}
                            />
                         </div>
                         <div className="flex items-center justify-between bg-gray-50 p-1.5 rounded border border-gray-200">
                            <span className="text-xs text-gray-500 font-mono">Y(é‡)</span>
                            <input 
                              type="number" 
                              min="0" max="100"
                              className="w-12 text-center text-sm border-gray-300 rounded focus:ring-indigo-500"
                              value={item.y}
                              onChange={(e) => handleUpdateQuestion(item.id, 'y', e.target.value)}
                            />
                         </div>
                         <div className="text-[10px] text-gray-400 text-center mt-1">
                           è±¡é™: {getQuadrant(item.x, item.y)}
                         </div>
                      </div>
                    </td>

                    {/* é€£çµç·¨è¼¯å€ */}
                    <td className="p-4 align-top pt-5">
                      <div className="flex items-center gap-2">
                        <LinkIcon size={16} className="text-gray-400 flex-shrink-0" />
                        <input 
                          type="text" 
                          placeholder="è«‹è²¼ä¸Š Google Drive æˆ– PDF é€£çµ..." 
                          className="w-full border border-gray-300 rounded px-2 py-1 text-gray-700 focus:ring-1 focus:ring-indigo-500 focus:outline-none"
                          value={knowledgeBase[item.id] || ''}
                          onChange={(e) => handleUpdateLink(item.id, e.target.value)}
                        />
                      </div>
                    </td>

                    {/* ç‹€æ…‹å€ */}
                    <td className="p-4 text-center align-top pt-5">
                      {knowledgeBase[item.id] ? (
                        <span className="inline-flex items-center justify-center w-8 h-8 rounded-full bg-green-100 text-green-600">
                          <CheckCircle size={16} />
                        </span>
                      ) : (
                        <span className="inline-flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 text-gray-300">
                          <FileText size={16} />
                        </span>
                      )}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    );
  }

  // 3. å•å·ç•«é¢
  if (currentStep === 'survey') {
    return (
      <div className="max-w-4xl mx-auto p-4 bg-gray-50 min-h-screen font-sans">
        <header className="mb-8 text-center bg-white p-6 rounded-xl shadow-sm relative">
          <div className="absolute top-4 right-4">
            <button 
               onClick={() => setCurrentStep('admin')}
               className="text-gray-400 hover:text-gray-600 flex items-center gap-1 text-xs px-2 py-1 rounded border border-transparent hover:border-gray-200 transition-all"
            >
               <Settings size={14} /> å¾Œå°ç®¡ç†
            </button>
          </div>
          <h1 className="text-3xl font-bold text-gray-800 mb-2">é•·ç…§å›°å¢ƒè¨ºæ–·é›·é”</h1>
          <p className="text-gray-600">è«‹å‹¾é¸æ‚¨ç›®å‰é¢è‡¨çš„ç…§é¡§é›£é¡Œï¼Œç³»çµ±å°‡ç‚ºæ‚¨ç”¢ç”Ÿå®¢è£½åŒ–çš„åˆ†æçŸ©é™£ã€‚</p>
        </header>

        <div className="space-y-6">
          {Object.entries(categories).map(([catKey, catName]) => (
            <div key={catKey} className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
              <div className="bg-blue-50 px-4 py-3 border-b border-blue-100 flex justify-between items-center">
                <h3 className="font-bold text-blue-900">{catKey}. {catName}</h3>
                <button 
                  onClick={() => selectAllInCategory(catKey)}
                  className="text-xs text-blue-600 hover:text-blue-800 underline"
                >
                  å…¨é¸/å–æ¶ˆ
                </button>
              </div>
              <div className="p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                {questionsData.filter(item => item.cat === catKey).map(item => (
                  <label key={item.id} className={`flex items-start p-2 rounded cursor-pointer transition-colors ${selectedIssues.has(item.id) ? 'bg-blue-50 ring-1 ring-blue-300' : 'hover:bg-gray-50'}`}>
                    <input 
                      type="checkbox" 
                      className="mt-1 mr-3 h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                      checked={selectedIssues.has(item.id)}
                      onChange={() => toggleIssue(item.id)}
                    />
                    <div>
                      <div className="font-medium text-gray-900">{item.label}</div>
                      <div className="text-xs text-gray-500">{item.desc}</div>
                    </div>
                  </label>
                ))}
              </div>
            </div>
          ))}
        </div>

        <div className="sticky bottom-0 bg-white border-t p-4 mt-8 flex justify-between items-center shadow-lg">
          <div className="text-gray-700">
            å·²é¸æ“‡ <span className="font-bold text-blue-600 text-xl">{selectedIssues.size}</span> å€‹å•é¡Œ
          </div>
          <button 
            onClick={handleFinishSurvey}
            className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-full font-bold shadow-md transition-all transform hover:scale-105"
          >
            é–‹å§‹åˆ†æ <ArrowRight size={20} />
          </button>
        </div>
      </div>
    );
  }

  // 4. åˆ†æçµæœç•«é¢
  return (
    <div className="max-w-6xl mx-auto p-4 bg-gray-50 min-h-screen font-sans">
      {/* é ‚éƒ¨å°è¦½ */}
      <div className="flex justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm">
        <h2 className="text-2xl font-bold text-gray-800">å•é¡Œåˆ†ä½ˆåˆ†æ</h2>
        <div className="flex gap-3">
           <button 
            onClick={() => setCurrentStep('report')}
            className="flex items-center gap-2 bg-white text-indigo-600 hover:bg-indigo-50 border border-indigo-200 px-4 py-2 rounded-lg font-bold shadow-sm transition-all"
           >
             <FileOutput size={18} /> ğŸ“„ åŒ¯å‡ºåˆ†æå ±å‘Š
           </button>
           <button 
            onClick={() => setCurrentStep('admin')}
            className="flex items-center gap-2 text-indigo-600 hover:text-indigo-800 px-4 py-2 border border-indigo-200 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition-colors"
          >
            <Settings size={16} /> ç®¡ç†å¾Œå°
          </button>
           <button 
            onClick={() => setCurrentStep('survey')}
            className="flex items-center gap-2 text-gray-600 hover:text-gray-900 px-4 py-2 border rounded-lg hover:bg-gray-50"
          >
            <RotateCcw size={16} /> é‡é¸å•é¡Œ
          </button>
        </div>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* å·¦å´ï¼šåœ–è¡¨æ§åˆ¶èˆ‡çµ±è¨ˆ */}
        <div className="lg:col-span-2 flex flex-col gap-4">
          
          {/* é®ç½©æ§åˆ¶ */}
          <div className="bg-white p-4 rounded-xl shadow-sm flex items-center justify-between">
            <div className="flex items-center gap-2 text-gray-700 font-medium">
              <Filter size={20} className="text-blue-600"/>
              é¡¯ç¤ºæ¨¡å¼ï¼š
            </div>
            <div className="flex bg-gray-100 p-1 rounded-lg">
              <button 
                onClick={() => setShowAll(false)}
                className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${!showAll ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}
              >
                åªçœ‹æˆ‘çš„å•é¡Œ ({selectedIssues.size})
              </button>
              <button 
                onClick={() => setShowAll(true)}
                className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${showAll ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}
              >
                é¡¯ç¤ºå…¨éƒ¨ 100 é¡Œ
              </button>
            </div>
          </div>

          {/* SVG äº’å‹•åœ–è¡¨ */}
          <div className="bg-white p-4 rounded-xl shadow-lg relative aspect-square w-full max-h-[600px] border border-gray-200">
            {/* è±¡é™èƒŒæ™¯æ¨™ç±¤ */}
            <div className="absolute inset-4 pointer-events-none grid grid-cols-2 grid-rows-2">
              <div className="flex justify-start items-start p-2 border-r border-b border-gray-100">
                <span className="text-yellow-600 bg-yellow-50 px-2 py-1 rounded text-xs font-bold">II. å„ªå…ˆæ”¹å–„ (æ˜“/é‡)</span>
              </div>
              <div className="flex justify-end items-start p-2 border-b border-gray-100">
                <span className="text-red-600 bg-red-50 px-2 py-1 rounded text-xs font-bold">I. å±æ©Ÿè™•ç† (é›£/é‡)</span>
              </div>
              <div className="flex justify-start items-end p-2 border-r border-gray-100">
                <span className="text-green-600 bg-green-50 px-2 py-1 rounded text-xs font-bold">III. æ—¥å¸¸ç¶­è­· (æ˜“/è¼•)</span>
              </div>
              <div className="flex justify-end items-end p-2">
                <span className="text-blue-600 bg-blue-50 px-2 py-1 rounded text-xs font-bold">IV. é•·æœŸè¦åŠƒ (é›£/è¼•)</span>
              </div>
            </div>

            {/* SVG Canvas */}
            <svg viewBox="0 0 110 110" className="w-full h-full">
              {/* è»¸ç·š */}
              <line x1="5" y1="55" x2="105" y2="55" stroke="#cbd5e1" strokeWidth="0.5" />
              <line x1="55" y1="105" x2="55" y2="5" stroke="#cbd5e1" strokeWidth="0.5" />
              
              {/* è»¸æ¨™ç±¤ */}
              <text x="105" y="58" fontSize="3" fill="#64748b" textAnchor="end">é›£åº¦é«˜</text>
              <text x="5" y="58" fontSize="3" fill="#64748b" textAnchor="start">é›£åº¦ä½</text>
              <text x="56" y="5" fontSize="3" fill="#64748b" textAnchor="start">é‡è¦æ€§é«˜</text>
              <text x="56" y="105" fontSize="3" fill="#64748b" textAnchor="start">é‡è¦æ€§ä½</text>

              {/* è³‡æ–™é» */}
              {questionsData.map((item) => {
                const isSelected = selectedIssues.has(item.id);
                const hasDoc = knowledgeBase[item.id]; // æª¢æŸ¥æ˜¯å¦æœ‰æ–‡ä»¶é€£çµ
                
                // é®ç½©é‚è¼¯ï¼šå¦‚æœæ²’é¸ä¸”ä¸åœ¨"ShowAll"æ¨¡å¼ï¼Œéš±è—
                if (!isSelected && !showAll) return null;

                // æ¨£å¼é‚è¼¯
                const opacity = isSelected ? 1 : 0.2; 
                const radius = isSelected ? (hoveredPoint === item.id ? 2.5 : 1.8) : 1;
                const quad = getQuadrant(item.x, item.y);
                const color = isSelected ? QUADRANTS[quad].dotColor : '#9ca3af';
                
                return (
                  <g 
                    key={item.id} 
                    onClick={() => toggleIssue(item.id)}
                    onMouseEnter={() => setHoveredPoint(item.id)}
                    onMouseLeave={() => setHoveredPoint(null)}
                    style={{ cursor: 'pointer', transition: 'all 0.3s' }}
                  >
                    <circle 
                      cx={item.x} 
                      cy={100 - item.y + 5} 
                      r={radius} 
                      fill={color}
                      opacity={opacity}
                      stroke={hasDoc && isSelected ? "#4f46e5" : "white"} // å¦‚æœæœ‰æ–‡ä»¶ï¼Œé¡¯ç¤ºä¸åŒé¡è‰²çš„é‚Šæ¡†
                      strokeWidth={hasDoc && isSelected ? "0.4" : "0.2"}
                    />
                    
                    {/* è‹¥æœ‰æ–‡ä»¶ï¼Œåœ¨é»æ—é‚ŠåŠ ä¸€å€‹å°æ¨™è¨˜ (åƒ…åœ¨ ShowAll ç‚º false æ™‚æˆ–è¢«é¸ä¸­æ™‚) */}
                    {hasDoc && isSelected && (
                      <circle cx={item.x + 1} cy={100 - item.y + 3.5} r="0.6" fill="#4f46e5" />
                    )}

                    {(isSelected || hoveredPoint === item.id) && (
                      <text 
                        x={item.x} 
                        y={100 - item.y + 2} 
                        fontSize={isSelected ? "2.5" : "2"} 
                        fill={color}
                        opacity={opacity}
                        textAnchor="middle"
                        fontWeight={isSelected ? "bold" : "normal"}
                      >
                        {item.label}
                      </text>
                    )}
                  </g>
                );
              })}
            </svg>

            {/* Tooltip */}
            {hoveredPoint && (
              <div className="absolute top-2 left-2 bg-gray-900 text-white text-sm p-3 rounded shadow-xl z-10 max-w-xs transition-opacity">
                {(() => {
                  const item = questionsData.find(i => i.id === hoveredPoint);
                  const hasDoc = knowledgeBase[item.id];
                  return (
                    <>
                      <div className="font-bold text-yellow-300 flex items-center gap-2">
                        {item.label}
                        {hasDoc && <span className="text-[10px] bg-indigo-600 px-1 rounded text-white font-normal">ğŸ“„ å«çŸ¥è­˜ç°¡å ±</span>}
                      </div>
                      <div>{item.desc}</div>
                      <div className="text-xs text-gray-400 mt-1">é›£åº¦: {item.x} | é‡è¦æ€§: {item.y}</div>
                    </>
                  );
                })()}
              </div>
            )}
          </div>
        </div>

        {/* å³å´ï¼šæ¸…å–®èˆ‡å»ºè­° */}
        <div className="flex flex-col gap-4 overflow-y-auto h-full max-h-[800px] pr-2">
          
          <div className="bg-blue-50 border border-blue-200 p-4 rounded-xl">
            <h3 className="font-bold text-blue-900 mb-2 flex items-center gap-2">
              <Info size={18} /> åˆ†æç¸½çµ
            </h3>
            <p className="text-sm text-blue-800">
              æ‚¨å‹¾é¸äº† {selectedIssues.size} å€‹å•é¡Œã€‚
              <br/>
              <span className="text-xs text-blue-600 mt-1 block">æç¤ºï¼šé»æ“Šåˆ—è¡¨ä¸­çš„ã€ŒğŸ“– é–±è®€è§£æ–¹ã€å¯é–‹å•Ÿè©²å•é¡Œçš„å°æ‡‰ç°¡å ±ã€‚</span>
            </p>
          </div>

          {['Q1', 'Q2', 'Q3', 'Q4'].map(quad => {
            const quadIssues = questionsData.filter(i => selectedIssues.has(i.id) && getQuadrant(i.x, i.y) === quad);
            if (quadIssues.length === 0) return null;

            return (
              <div key={quad} className={`border rounded-xl overflow-hidden shadow-sm ${QUADRANTS[quad].color.replace('bg-', 'bg-opacity-20 ')}`}>
                <div className={`px-4 py-2 font-bold text-sm flex justify-between items-center ${QUADRANTS[quad].color}`}>
                  {QUADRANTS[quad].title}
                  <span className="bg-white bg-opacity-30 px-2 py-0.5 rounded text-xs">{quadIssues.length}</span>
                </div>
                <div className="p-3 bg-white">
                  <ul className="space-y-3">
                    {quadIssues.map(item => {
                      const docLink = knowledgeBase[item.id];
                      return (
                        <li key={item.id} className="flex flex-col items-start gap-1 text-sm border-b border-gray-50 last:border-0 pb-3 last:pb-0">
                          <div className="flex items-start gap-2 w-full">
                             <CheckCircle size={14} className="mt-0.5 flex-shrink-0 opacity-50" />
                             <div className="flex-1">
                               <span className="font-bold text-gray-800">{item.label}</span>
                               <span className="text-gray-500 block text-xs">({item.desc})</span>
                             </div>
                          </div>
                          
                          {/* çŸ¥è­˜åº«é€£çµæŒ‰éˆ• */}
                          {docLink && (
                            <a 
                              href={docLink} 
                              target="_blank" 
                              rel="noopener noreferrer"
                              className="ml-6 mt-1 flex items-center gap-1 text-xs text-white bg-indigo-600 hover:bg-indigo-700 px-3 py-1.5 rounded-full transition-colors w-fit shadow-sm"
                            >
                              <FileText size={12} />
                              ğŸ“– é–±è®€è§£æ–¹ç°¡å ±
                              <ExternalLink size={10} />
                            </a>
                          )}
                        </li>
                      );
                    })}
                  </ul>
                </div>
              </div>
            );
          })}
          
        </div>
      </div>
    </div>
  );
}